<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Λαβύρινθος με A-Frame και Collision</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <!-- vibe-coding: custom collision and door scripts -->
    <script>
      // Collision detection component (basic)
      AFRAME.registerComponent('simple-collision', {
        schema: {walls: {type: 'selectorAll'}},
        init: function () {
          this.lastPosition = this.el.object3D.position.clone();
        },
        tick: function () {
          let pos = this.el.object3D.position;
          for (let wall of this.data.walls) {
            let wpos = wall.object3D.position;
            let wsize = wall.getAttribute('geometry');
            let minX = wpos.x - wsize.width/2, maxX = wpos.x + wsize.width/2;
            let minZ = wpos.z - wsize.depth/2, maxZ = wpos.z + wsize.depth/2;
            let minY = wpos.y - wsize.height/2, maxY = wpos.y + wsize.height/2;
            // Simple bounding box collision
            if (pos.x > minX && pos.x < maxX &&
                pos.y > minY && pos.y < maxY &&
                pos.z > minZ && pos.z < maxZ) {
              pos.copy(this.lastPosition); // revert to last position
              return;
            }
          }
          // Update last valid position
          this.lastPosition.copy(pos);
        }
      });

      // Door interaction
      AFRAME.registerComponent('door-interaction', {
        init: function () {
          this.el.addEventListener('mouseenter', () => {
            document.querySelector('#door-audio').play();
            document.querySelector('#door-msg').setAttribute('visible', true);
          });
          this.el.addEventListener('mouseleave', () => {
            document.querySelector('#door-msg').setAttribute('visible', false);
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <!-- Ουρανός -->
      <a-sky color="#222"></a-sky>

      <!-- Λαβύρινθος: Τοίχοι -->
      <a-box position="0 1 -5" width="10" height="2" depth="0.3" color="#555" id="wall1"></a-box>
      <a-box position="5 1 0" width="0.3" height="2" depth="10" color="#555" id="wall2"></a-box>
      <a-box position="0 1 5" width="10" height="2" depth="0.3" color="#555" id="wall3"></a-box>
      <a-box position="-5 1 0" width="0.3" height="2" depth="10" color="#555" id="wall4"></a-box>
      <!-- Εσωτερικοί τοίχοι με πόρτες (ανοίγματα) -->
      <a-box position="0 1 -2" width="6" height="2" depth="0.3" color="#666"></a-box>
      <a-box position="0 1 2" width="6" height="2" depth="0.3" color="#666"></a-box>
      <!-- Πόρτα (απλό κουτί με μικρό πλάτος για να περνάει ο χρήστης) -->
      <a-box position="0 1 0" width="2" height="2" depth="0.3" color="#ff0" door-interaction></a-box>
      <a-text id="door-msg" value="Πέρασες την πόρτα!" position="0 2.5 0" visible="false" align="center" color="#fff"></a-text>
      <audio id="door-audio" src="https://cdn.pixabay.com/audio/2022/10/16/audio_12a3263e7a.mp3"></audio>
      
      <!-- Κάμερα χρήστη με collision -->
      <a-entity camera wasd-controls look-controls position="0 1.6 -7"
                simple-collision="walls: #wall1, #wall2, #wall3, #wall4"
                ></a-entity>
    </a-scene>
  </body>
</html>
